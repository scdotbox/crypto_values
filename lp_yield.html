<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMM æµåŠ¨æ€§æŒ–çŸ¿ (LP) æ”¶ç›Šä¸æ— å¸¸æŸå¤±è®¡ç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-button.active {
            background-color: #1E40AF; /* bg-blue-800 */
            color: white;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2d3748;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex justify-center items-start min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-8 space-y-8">
        
        <!-- Navigation -->
        <nav class="mb-6">
            <a href="index.html" class="inline-flex items-center text-blue-400 hover:text-blue-300 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                </svg>
                è¿”å›ä¸»é¡µ
            </a>
        </nav>
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300">AMM æ”¶ç›Šä¸é£é™©åˆ†æå™¨</h1>
            <p class="mt-2 text-gray-400">è®¡ç®—æµåŠ¨æ€§æ±  (LP) çš„é¢„ä¼°å¹´åŒ–æ”¶ç›Š (APY) å’Œæ— å¸¸æŸå¤± (IL)</p>
        </div>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Panel: Inputs -->
            <div class="bg-gray-700/50 p-6 rounded-xl space-y-6">
                <h2 class="text-xl font-semibold border-b border-gray-600 pb-3">1. è¾“å…¥å‚æ•°</h2>

                <!-- Protocol Selector -->
                <div>
                    <label for="protocol" class="block text-sm font-medium text-gray-300 mb-2">é€‰æ‹©åè®®æ¨¡å‹</label>
                    <select id="protocol" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="uniswap_v3">é›†ä¸­æµåŠ¨æ€§ (Uniswap V3/V4, MMT, Meteora DLMM)</option>
                        <option value="uniswap_v2">æ ‡å‡† AMM (Uniswap V2, etc.)</option>
                    </select>
                </div>

                <!-- Token Pair -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">äº¤æ˜“å¯¹ (Token Pair)</label>
                    <div class="flex space-x-2">
                        <input type="text" id="tokenA" value="SUI" class="w-1/2 bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-center" placeholder="Token A (e.g. ETH)">
                        <input type="text" id="tokenB" value="USDC" class="w-1/2 bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-center" placeholder="Token B (e.g. USDC)">
                    </div>
                </div>

                <!-- Liquidity Input -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">æŠ•å…¥æµåŠ¨æ€§æ–¹å¼</label>
                    <div id="liquidity-tabs" class="flex bg-gray-800 rounded-lg p-1 border border-gray-600">
                        <button class="tab-button w-1/2 p-2 rounded-md text-sm font-medium active" data-tab="balanced">å‡è¡¡æŠ•å…¥</button>
                        <button class="tab-button w-1/2 p-2 rounded-md text-sm font-medium" data-tab="single">å•å¸æŠ•å…¥</button>
                    </div>
                    <div id="liquidity-inputs" class="mt-4 space-y-3">
                        <div id="balanced-input">
                            <input type="number" id="amountA" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2" placeholder="Token A æ•°é‡">
                            <input type="number" id="amountB" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mt-2" placeholder="Token B æ•°é‡">
                        </div>
                        <div id="single-input" class="hidden">
                            <select id="single-token-select" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mb-2"></select>
                            <input type="number" id="single-amount" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2" placeholder="æŠ•å…¥æ•°é‡">
                        </div>
                    </div>
                </div>
                
                <!-- Price Inputs -->
                <div class="space-y-3">
                    <div class="relative">
                        <label for="currentPrice" class="block text-sm font-medium text-gray-300">å½“å‰ä»·æ ¼ (<span id="price-label-current">Token A / Token B</span>)</label>
                        <input type="number" id="currentPrice" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mt-1" placeholder="ä¾‹å¦‚: 1.5">
                    </div>
                    <div id="range-inputs" class="space-y-3">
                        <label class="block text-sm font-medium text-gray-300">è®¾ç½®ä»·æ ¼èŒƒå›´</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="lowerBound" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2" placeholder="æœ€ä½ä»·">
                            <span class="text-gray-400">-</span>
                            <input type="number" id="upperBound" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2" placeholder="æœ€é«˜ä»·">
                        </div>
                    </div>
                    <div>
                        <label for="futurePrice" class="block text-sm font-medium text-gray-300">é¢„æœŸæœªæ¥ä»·æ ¼</label>
                        <input type="number" id="futurePrice" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mt-1" placeholder="ç”¨äºè®¡ç®—æ— å¸¸æŸå¤±">
                    </div>
                </div>
                
                <!-- APY & Time Inputs -->
                <div class="space-y-3">
                     <label class="block text-sm font-medium text-gray-300">æ”¶ç›Šä¼°ç®—å‚æ•°
                        <span class="tooltip">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                            <span class="tooltiptext">æ‰‹ç»­è´¹ APY æ˜¯åŸºäºæ‚¨æä¾›çš„äº¤æ˜“é‡å’ŒæµåŠ¨æ€§ä¼°ç®—å¾—å‡ºçš„ï¼Œå®é™…æ”¶ç›Šä¼šæ ¹æ®å¸‚åœºæƒ…å†µåŠ¨æ€å˜åŒ–ã€‚</span>
                        </span>
                     </label>
                     <input type="number" id="dailyVolume" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2" placeholder="äº¤æ˜“å¯¹ 24h äº¤æ˜“é‡ ($)">
                     <input type="number" id="tvl" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mt-2" placeholder="æ± ä¸­æ€»æµåŠ¨æ€§ TVL ($)">
                     <input type="number" id="feeTier" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mt-2" placeholder="æ‰‹ç»­è´¹ç‡ (%) e.g. 0.3">
                     <input type="number" id="investmentDuration" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mt-2" placeholder="æŠ•èµ„å¤©æ•° (e.g. 30)">
                </div>

                <button id="calculateBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                    å¼€å§‹è®¡ç®—
                </button>
            </div>

            <!-- Right Panel: Results -->
            <div class="bg-gray-700/50 p-6 rounded-xl space-y-6">
                <h2 class="text-xl font-semibold border-b border-gray-600 pb-3">2. åˆ†æç»“æœ</h2>
                <div id="results-output" class="space-y-5 hidden">
                    <!-- Profit & Loss Analysis -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="font-semibold text-lg text-blue-300 mb-3">æ”¶ç›Šä¸äºæŸ (P&L) åˆ†æ</h3>
                        <div class="space-y-4 text-sm">
                            <div class="flex justify-between items-center">
                                <p class="text-gray-400">è‹¥ç›´æ¥æŒæœ‰ (HODL) ä»·å€¼</p>
                                <p id="hodlValue" class="text-lg font-bold"></p>
                            </div>
                             <div class="flex justify-between items-center">
                                <p class="text-gray-400">LP ä»“ä½ä»·å€¼ (æœªè®¡å…¥æ‰‹ç»­è´¹)</p>
                                <p id="lpValue" class="text-lg font-bold"></p>
                            </div>
                            <div class="flex justify-between items-center">
                                <p class="text-gray-400">æ— å¸¸æŸå¤± (IL)</p>
                                <div class="flex items-center space-x-2">
                                    <p id="ilValue" class="text-lg font-bold"></p>
                                    <p id="ilPercentage" class="text-base font-semibold px-2 py-0.5 rounded-md"></p>
                                </div>
                            </div>
                            <hr class="border-gray-600">
                             <div class="flex justify-between items-center">
                                <p class="text-gray-400">æ‰‹ç»­è´¹æ€»æ”¶ç›Š</p>
                                <p id="feeEarnings" class="text-lg font-bold text-green-400"></p>
                            </div>
                            <div class="flex justify-between items-center pt-2">
                                <p class="text-lg font-semibold text-gray-200">å‡€æ”¶ç›Š/äºæŸ (vs HODL)</p>
                                <p id="netProfit" class="text-2xl font-bold"></p>
                            </div>
                        </div>
                    </div>
                    <!-- APY -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                         <h3 class="font-semibold text-lg text-teal-300 mb-2">é¢„ä¼°å¹´åŒ–æ”¶ç›Š (APY)</h3>
                         <div class="flex items-baseline space-x-2">
                            <p id="apy" class="text-3xl font-bold"></p>
                            <span class="text-gray-400">æ‰‹ç»­è´¹ APY</span>
                         </div>
                         <p id="apy-disclaimer" class="text-xs text-gray-500 mt-2"></p>
                    </div>
                    <!-- Position Info -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="font-semibold text-lg text-gray-300 mb-2">ä»“ä½è¯¦æƒ…</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><p class="text-gray-400">åˆå§‹æ€»ä»·å€¼</p><p id="initialValue" class="font-semibold"></p></div>
                            <div><p class="text-gray-400">åè®®æ¨¡å‹</p><p id="protocolUsed" class="font-semibold"></p></div>
                            <div><p class="text-gray-400">æŠ•å…¥ <span id="tokenA-name-res"></span></p><p id="tokenAAmount" class="font-semibold"></p></div>
                            <div><p class="text-gray-400">æŠ•å…¥ <span id="tokenB-name-res"></span></p><p id="tokenBAmount" class="font-semibold"></p></div>
                        </div>
                    </div>
                    <!-- Range Suggestion -->
                    <div id="suggestion-box" class="bg-blue-900/40 p-4 rounded-lg border border-blue-500 hidden">
                        <h3 class="font-semibold text-lg text-blue-300 mb-2">ğŸ’¡ ä»·æ ¼åŒºé—´å»ºè®®</h3>
                        <p id="rangeSuggestion" class="text-sm"></p>
                    </div>
                </div>
                <div id="welcome-message" class="text-center text-gray-400 py-10">
                    <p>è¯·è¾“å…¥å‚æ•°å¹¶ç‚¹å‡» "å¼€å§‹è®¡ç®—" ä»¥æŸ¥çœ‹ç»“æœã€‚</p>
                    <p class="text-sm mt-2">æ­¤å·¥å…·æ—¨åœ¨å¸®åŠ©ç†è§£ AMM æœºåˆ¶ï¼Œå¹¶éè´¢åŠ¡å»ºè®®ã€‚</p>
                </div>
                <div id="error-message" class="text-center text-red-400 p-4 bg-red-900/50 rounded-lg hidden"></div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const protocolSelect = document.getElementById('protocol');
        const rangeInputs = document.getElementById('range-inputs');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultsOutput = document.getElementById('results-output');
        const welcomeMessage = document.getElementById('welcome-message');
        const errorMessage = document.getElementById('error-message');
        const suggestionBox = document.getElementById('suggestion-box');

        const tokenAInput = document.getElementById('tokenA');
        const tokenBInput = document.getElementById('tokenB');
        
        const priceLabelCurrent = document.getElementById('price-label-current');

        const liquidityTabs = document.getElementById('liquidity-tabs');
        const balancedInputDiv = document.getElementById('balanced-input');
        const singleInputDiv = document.getElementById('single-input');
        const singleTokenSelect = document.getElementById('single-token-select');
        let liquidityMode = 'balanced';

        // Event Listeners
        protocolSelect.addEventListener('change', toggleRangeInputs);
        calculateBtn.addEventListener('click', performCalculations);
        
        tokenAInput.addEventListener('keyup', updateLabels);
        tokenBInput.addEventListener('keyup', updateLabels);

        liquidityTabs.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                document.querySelector('.tab-button.active').classList.remove('active');
                e.target.classList.add('active');
                liquidityMode = e.target.dataset.tab;
                toggleLiquidityInputs();
            }
        });

        function updateLabels() {
            const tokenA = tokenAInput.value || 'Token A';
            const tokenB = tokenBInput.value || 'Token B';
            priceLabelCurrent.textContent = `${tokenA} / ${tokenB}`;
            
            document.getElementById('tokenA-name-res').textContent = tokenA;
            document.getElementById('tokenB-name-res').textContent = tokenB;

            // Update single token select options
            singleTokenSelect.innerHTML = `
                <option value="A">${tokenA}</option>
                <option value="B">${tokenB}</option>
            `;
        }

        function toggleLiquidityInputs() {
            if (liquidityMode === 'balanced') {
                balancedInputDiv.style.display = 'block';
                singleInputDiv.style.display = 'none';
            } else {
                balancedInputDiv.style.display = 'none';
                singleInputDiv.style.display = 'block';
            }
        }

        function toggleRangeInputs() {
            if (protocolSelect.value === 'uniswap_v2') {
                rangeInputs.style.display = 'none';
                suggestionBox.style.display = 'none';
            } else {
                rangeInputs.style.display = 'block';
            }
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            resultsOutput.style.display = 'none';
            welcomeMessage.style.display = 'none';
        }

        function performCalculations() {
            // Clear previous errors and results
            errorMessage.style.display = 'none';

            // --- 1. Get all input values and parse them ---
            const protocol = protocolSelect.value;
            
            const tokenA = document.getElementById('tokenA').value || 'Token A';
            const tokenB = document.getElementById('tokenB').value || 'Token B';
            
            let amountA = parseFloat(document.getElementById('amountA').value);
            let amountB = parseFloat(document.getElementById('amountB').value);
            const singleAmount = parseFloat(document.getElementById('single-amount').value);
            const singleTokenType = document.getElementById('single-token-select').value;

            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const futurePrice = parseFloat(document.getElementById('futurePrice').value);
            const lowerBound = parseFloat(document.getElementById('lowerBound').value);
            const upperBound = parseFloat(document.getElementById('upperBound').value);
            
            const dailyVolume = parseFloat(document.getElementById('dailyVolume').value);
            const tvl = parseFloat(document.getElementById('tvl').value);
            const feeTier = parseFloat(document.getElementById('feeTier').value) / 100;
            const investmentDuration = parseFloat(document.getElementById('investmentDuration').value);


            // --- 2. Input Validation ---
            if (isNaN(currentPrice) || isNaN(futurePrice)) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„å½“å‰ä»·æ ¼å’Œé¢„æœŸæœªæ¥ä»·æ ¼ã€‚'); return;
            }
            if (liquidityMode === 'balanced' && (isNaN(amountA) || isNaN(amountB))) {
                 showError('åœ¨å‡è¡¡æŠ•å…¥æ¨¡å¼ä¸‹ï¼Œè¯·è¾“å…¥ä¸¤ç§ä»£å¸çš„æ•°é‡ã€‚'); return;
            }
             if (liquidityMode === 'single' && isNaN(singleAmount)) {
                showError('åœ¨å•å¸æŠ•å…¥æ¨¡å¼ä¸‹ï¼Œè¯·è¾“å…¥ä»£å¸æ•°é‡ã€‚'); return;
            }
            if (protocol === 'uniswap_v3' && (isNaN(lowerBound) || isNaN(upperBound))) {
                showError('å¯¹äºé›†ä¸­æµåŠ¨æ€§åè®®ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼èŒƒå›´ã€‚'); return;
            }
             if (protocol === 'uniswap_v3' && lowerBound >= upperBound) {
                showError('ä»·æ ¼èŒƒå›´çš„æœ€ä½ä»·å¿…é¡»ä½äºæœ€é«˜ä»·ã€‚'); return;
            }
            if (protocol === 'uniswap_v3' && (currentPrice < lowerBound || currentPrice > upperBound)) {
                showError('å½“å‰ä»·æ ¼å¿…é¡»åœ¨æ‚¨è®¾å®šçš„ä»·æ ¼èŒƒå›´ä¹‹å†…æ‰èƒ½æ·»åŠ æµåŠ¨æ€§ã€‚'); return;
            }
            if (isNaN(dailyVolume) || isNaN(tvl) || isNaN(feeTier) || isNaN(investmentDuration)) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ˜“é‡ã€TVLã€æ‰‹ç»­è´¹ç‡å’ŒæŠ•èµ„å¤©æ•°ä»¥è®¡ç®—æ”¶ç›Šã€‚'); return;
            }

            // --- 3. Handle Asymmetric Liquidity Provision ---
            if (liquidityMode === 'single') {
                if (singleTokenType === 'A') {
                    const totalValue = singleAmount * currentPrice;
                    amountB = totalValue / 2;
                    amountA = (totalValue / 2) / currentPrice;
                } else { // Token B
                    const totalValue = singleAmount;
                    amountB = totalValue / 2;
                    amountA = (totalValue / 2) / currentPrice;
                }
            }


            // --- 4. Core Calculations based on protocol ---
            let hodlValue, lpValue, ilValue, ilPercentage, apy = 0;
            const initialValue = amountA * currentPrice + amountB;
            
            if (protocol === 'uniswap_v2') {
                const k = amountA * amountB;
                const priceRatio = futurePrice / currentPrice;
                
                const lpAmountA = Math.sqrt(k / futurePrice);
                const lpAmountB = Math.sqrt(k * futurePrice);
                lpValue = lpAmountA * futurePrice + lpAmountB;
                hodlValue = amountA * futurePrice + amountB;
                
                const ilFactor = (2 * Math.sqrt(priceRatio)) / (1 + priceRatio) - 1;
                ilValue = hodlValue * ilFactor;
                ilPercentage = ilFactor * 100;
                
                // V2 APY Calculation: (DailyFees / TVL) annualized.
                if (tvl > 0) {
                    apy = (dailyVolume * feeTier / tvl) * 365 * 100;
                }

            } else { // uniswap_v3 and other concentrated liquidity models
                const sqrtP = Math.sqrt(currentPrice);
                const sqrtPa = Math.sqrt(lowerBound);
                const sqrtPb = Math.sqrt(upperBound);
                const sqrtPf = Math.sqrt(futurePrice);
                
                let L = 0;
                const L_from_A = amountA * sqrtP * sqrtPb / (sqrtPb - sqrtP);
                const L_from_B = amountB / (sqrtP - sqrtPa);
                L = Math.min(L_from_A, L_from_B);
                
                let futureAmountA, futureAmountB;
                if (futurePrice <= lowerBound) {
                    futureAmountA = 0;
                    futureAmountB = L * (sqrtPb - sqrtPa);
                } else if (futurePrice >= upperBound) {
                    futureAmountA = L * (1/sqrtPa - 1/sqrtPb);
                    futureAmountB = 0;
                } else {
                    futureAmountA = L * (1/sqrtPf - 1/sqrtPb);
                    futureAmountB = L * (sqrtPf - sqrtPa);
                }
                lpValue = futureAmountA * futurePrice + futureAmountB;
                hodlValue = amountA * futurePrice + amountB;
                
                ilValue = lpValue - hodlValue;
                ilPercentage = hodlValue > 0 ? (ilValue / hodlValue) * 100 : 0;
                
                // V3 APY Calculation (REVISED & FIXED)
                // The base APY of the pool is (DailyFees / TVL), and we apply a concentration factor bonus.
                if (tvl > 0 && upperBound > lowerBound) {
                    const basePoolApy = (dailyVolume * feeTier / tvl) * 365 * 100;
                    // The concentration factor magnifies returns. A tighter range gives a higher bonus.
                    // Heuristic: Price / RangeWidth. A higher value means more concentrated.
                    const concentrationFactor = currentPrice / (upperBound - lowerBound);
                    // Final APY is the base pool APY multiplied by the concentration factor.
                    // We add a cap to prevent absurdly high APYs from very tight ranges.
                    apy = basePoolApy * Math.min(concentrationFactor, 50); // Cap factor at 50x
                }

                document.getElementById('apy-disclaimer').textContent = "é›†ä¸­æµåŠ¨æ€§APYä¸ºé«˜åº¦ç®€åŒ–çš„ä¼°ç®—å€¼ï¼Œå› å…¶èµ„æœ¬æ•ˆç‡åŠ æˆï¼Œå®é™…æ”¶ç›Šä¼šå—ä»·æ ¼æ³¢åŠ¨å’Œæ± å†…æµåŠ¨æ€§åˆ†å¸ƒå½±å“ã€‚";

                const volatility = 0.25;
                const suggestedLower = currentPrice * (1 - volatility);
                const suggestedUpper = currentPrice * (1 + volatility);
                document.getElementById('rangeSuggestion').textContent = `åŸºäºå¯¹æœªæ¥25%ä»·æ ¼æ³¢åŠ¨çš„ä¿å®ˆä¼°è®¡ï¼Œä¸€ä¸ªå¯èƒ½çš„èµ·å§‹èŒƒå›´æ˜¯ [${suggestedLower.toFixed(2)}, ${suggestedUpper.toFixed(2)}]ã€‚è¿™èƒ½è¾ƒå¥½åœ°å¹³è¡¡æ‰‹ç»­è´¹æ”¶ç›Šå’Œæ— å¸¸æŸå¤±é£é™©ã€‚è¯·æ ¹æ®æ‚¨å¯¹å¸‚åœºçš„åˆ¤æ–­è¿›è¡Œè°ƒæ•´ã€‚`;
                suggestionBox.style.display = 'block';
            }
            
            // --- 5. Calculate final P&L ---
            const totalFeeEarnings = initialValue * (apy / 100) * (investmentDuration / 365);
            const netProfitVsHodl = ilValue + totalFeeEarnings;

            // --- 6. Display Results ---
            displayResults({
                initialValue, hodlValue, lpValue, ilValue, ilPercentage,
                apy, protocol, totalFeeEarnings, netProfitVsHodl,
                tokenA: { name: tokenA, amount: amountA },
                tokenB: { name: tokenB, amount: amountB },
            });
        }
        
        function displayResults(data) {
            welcomeMessage.style.display = 'none';
            resultsOutput.style.display = 'block';

            const formatCurrency = (val) => `$${val.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;

            document.getElementById('initialValue').textContent = formatCurrency(data.initialValue);
            document.getElementById('hodlValue').textContent = formatCurrency(data.hodlValue);
            document.getElementById('lpValue').textContent = formatCurrency(data.lpValue);
            document.getElementById('ilValue').textContent = formatCurrency(data.ilValue);
            
            const ilPercElem = document.getElementById('ilPercentage');
            ilPercElem.textContent = `${data.ilPercentage.toFixed(2)}%`;
            ilPercElem.className = data.ilPercentage < -0.01 ? 'text-base font-semibold px-2 py-0.5 rounded-md bg-red-500 text-white' : 'text-base font-semibold px-2 py-0.5 rounded-md bg-green-500 text-white';
            
            document.getElementById('feeEarnings').textContent = `+ ${formatCurrency(data.totalFeeEarnings)}`;
            
            const netProfitElem = document.getElementById('netProfit');
            netProfitElem.textContent = formatCurrency(data.netProfitVsHodl);
            netProfitElem.className = data.netProfitVsHodl < 0 ? 'text-2xl font-bold text-red-400' : 'text-2xl font-bold text-green-400';

            document.getElementById('apy').textContent = data.apy.toFixed(2) + '%';
            
            document.getElementById('protocolUsed').textContent = data.protocol === 'uniswap_v2' ? 'æ ‡å‡† AMM' : 'é›†ä¸­æµåŠ¨æ€§';
            document.getElementById('tokenAAmount').textContent = `${data.tokenA.amount.toFixed(4)} ${data.tokenA.name}`;
            document.getElementById('tokenBAmount').textContent = `${data.tokenB.amount.toFixed(4)} ${data.tokenB.name}`;
            
            if (protocolSelect.value === 'uniswap_v2') {
                 suggestionBox.style.display = 'none';
                 document.getElementById('apy-disclaimer').textContent = "æ ‡å‡† AMM çš„ APY ä¼°ç®—åŸºäºæ•´ä¸ªæ± å­çš„æ•°æ®ï¼Œæ‚¨çš„å®é™…æ”¶ç›Šå–å†³äºæ‚¨åœ¨æ€»æµåŠ¨æ€§ä¸­çš„å æ¯”ã€‚";
            }
        }
        
        // Initial setup
        updateLabels();
        toggleRangeInputs();
        toggleLiquidityInputs();

    </script>
</body>
</html>
